<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle}"></title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50">

<div th:fragment="form-content" class="max-w-6xl mx-auto bg-white rounded-lg p-8">
    <h2 class="text-3xl font-bold text-gray-800 mb-8" th:text="${pageTitle}">Titre du Formulaire</h2>

    <form id="product-batch-form" th:action="@{/produits/save-batch}" th:object="${productBatchDto}" method="post">
        <!-- Jeton CSRF -->
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <!-- Informations sur la facture -->
        <div class="bg-gray-50 p-6 rounded-xl mb-8 border border-gray-200">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Informations sur la Facture</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label for="numeroFacture" class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-file-invoice mr-2"></i>Numéro de facture *</label>
                    <input type="text" id="numeroFacture" th:field="*{numeroFacture}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           required>
                </div>
                <div>
                    <label for="nomFournisseur" class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-building mr-2"></i>Nom du fournisseur</label>
                    <input type="text" id="nomFournisseur" th:field="*{nomFournisseur}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
        </div>

        <!-- Conteneur pour les produits -->
        <div id="product-lines-container">
            <!-- Les lignes de produits seront ajoutées ici par JavaScript -->
        </div>

        <!-- Bouton pour ajouter un produit -->
        <div class="mt-6">
            <button type="button" id="add-product-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-300 ease-in-out flex items-center">
                <i class="fas fa-plus-circle mr-2"></i>Ajouter un produit à la facture
            </button>
        </div>
    </form>
</div>

<script th:inline="javascript">
document.addEventListener('DOMContentLoaded', function () {
    const container = document.getElementById('product-lines-container');
    const addProductBtn = document.getElementById('add-product-btn');
    let productIndex = 0;

    function addNewProductLine() {
        const productLineHtml = `
            <div class="product-line border-t pt-6 mt-6">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="text-lg font-semibold text-gray-700">Produit #${productIndex + 1}</h4>
                    <button type="button" class="remove-product-btn text-red-500 hover:text-red-700 font-semibold">
                        <i class="fas fa-trash-alt mr-1"></i>Supprimer
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- Nom & Catégorie -->
                    <div class="md:col-span-1">
                        <label class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-tag mr-2"></i>Nom du produit *</label>
                        <input type="text" name="produits[${productIndex}].nom" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        
                        <label class="block text-sm font-medium text-gray-700 mt-4 mb-1"><i class="fas fa-sitemap mr-2"></i>Famille</label>
                        <input type="text" name="produits[${productIndex}].categorie"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <!-- Prix -->
                    <div class="md:col-span-1 grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-dollar-sign mr-2"></i>Prix d'achat *</label>
                            <input type="number" step="0.01" name="produits[${productIndex}].prixAchat" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-money-bill-wave mr-2"></i>Prix de vente *</label>
                            <input type="number" step="0.01" name="produits[${productIndex}].prixVenteUnitaire" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <!-- Stock & Péremption -->
                    <div class="md:col-span-1 grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-boxes-stacked mr-2"></i>Quantité *</label>
                            <input type="number" name="produits[${productIndex}].quantiteEnStock" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-calendar-times mr-2"></i>Péremption</label>
                            <input type="date" name="produits[${productIndex}].datePeremption"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                </div>
                 <div class="grid grid-cols-1 md:grid-cols-1 gap-4">
                  <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1"><i class="fas fa-barcode mr-2"></i>Code-barres</label>
                            <input type="text" name="produits[${productIndex}].codeBarres"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                 </div>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', productLineHtml);
        productIndex++;
    }

    addProductBtn.addEventListener('click', addNewProductLine);

    container.addEventListener('click', function(e) {
        if (e.target.closest('.remove-product-btn')) {
            e.target.closest('.product-line').remove();
        }
    });

    // Ajouter une première ligne de produit au chargement
    addNewProductLine();
});
</script>

</body>
</html>