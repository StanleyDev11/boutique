<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>Rapport des Ventes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
        }
        .report-container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
            background: #fff;
        }
        .report-header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 2px solid #eee;
            padding-bottom: 20px;
        }
        .report-header h1 {
            font-size: 2.5em;
            margin: 0;
            color: #1a202c;
        }
        .report-header p {
            font-size: 1.1em;
            color: #718096;
            margin: 5px 0;
        }
        .sale-block {
            margin-bottom: 30px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            overflow: hidden;
        }
        .sale-header {
            background-color: #f7fafc;
            padding: 10px 15px;
            border-bottom: 1px solid #e2e8f0;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .sale-header div {
            font-size: 0.9em;
        }
        .sale-header strong {
            color: #4a5568;
            font-weight: 600;
        }
        .products-table {
            width: 100%;
            border-collapse: collapse;
        }
        .products-table th, .products-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        .products-table th {
            background-color: #f7fafc;
            font-weight: 600;
            font-size: 0.85em;
            text-transform: uppercase;
            color: #718096;
        }
        .products-table tr:last-child td {
            border-bottom: none;
        }
        .text-right {
            text-align: right;
        }
        .report-summary {
            margin-top: 40px;
            padding: 20px;
            background-color: #edf2f7;
            border-radius: 8px;
            text-align: right;
        }
        .report-summary h2 {
            font-size: 1.8em;
            margin: 0;
            color: #1a202c;
        }
        .print-button {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #3b82f6;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        @media print {
            body {
                background-color: #fff;
            }
            .report-container {
                max-width: 100%;
                padding: 0;
                box-shadow: none;
                border: none;
            }
            .print-button {
                display: none;
            }
            .sale-block {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>

<div class="report-container">
    <div class="report-header">
        <h1 class="text-3xl font-bold text-gray-800">SUPERMARCHE EasyStock</h1>
        <p class="text-sm text-gray-600">Bd. Jean Paul II, Près de la TDE, Hédzranawoé, Lomé - Togo</p>
        <p class="text-sm text-gray-600">Tél: (+228) 96 00 01 89 / 90 12 34 30</p>
        <h2 class="text-2xl font-semibold text-gray-700 mt-4">Rapport des Ventes</h2>
        <p th:text="${'Période du ' + #temporals.format(startDate, 'dd/MM/yyyy') + ' au ' + #temporals.format(endDate, 'dd/MM/yyyy')}"></p>
        <p class="text-xs text-gray-500 mt-1" th:text="${'Généré le ' + #temporals.format(dateGeneration, 'dd/MM/yyyy HH:mm')}"></p>
    </div>

    <div th:each="jour : ${ventesParJour.keySet().stream().sorted().toList()}">
        <h3 class="daily-header" th:text="${'Journée du ' + #temporals.format(jour, 'dd MMMM yyyy')}"></h3>

        <div th:each="vente : ${ventesParJour.get(jour)}" class="sale-block">
            <div class="sale-header">
                <div><strong>Facture #:</strong> <span th:text="${vente.id}"></span></div>
                <div><strong>Date:</strong> <span th:text="${#temporals.format(vente.dateVente, 'HH:mm')}"></span></div>
                <div><strong>Client:</strong> <span th:text="${vente.client != null ? vente.client.nom : 'Client de passage'}"></span></div>
                <div><strong>Caissier:</strong> <span th:text="${vente.utilisateur.username}"></span></div>
                <div><strong>Paiement:</strong> <span th:text="${vente.moyenPaiement}"></span></div>
                <div class="text-right"><strong>Total Vente:</strong> <span th:text="${#numbers.formatDecimal(vente.totalFinal, 0, 'POINT', 2, 'COMMA') + ' FCFA'}"></span></div>
            </div>
            <table class="products-table">
                <thead>
                <tr>
                    <th>Produit</th>
                    <th class="text-right">Quantité</th>
                    <th class="text-right">Prix Unitaire</th>
                    <th class="text-right">Total Ligne</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="ligne : ${vente.ligneVentes}">
                    <td th:text="${ligne.produit.nom}"></td>
                    <td class="text-right" th:text="${ligne.quantite}"></td>
                    <td class="text-right" th:text="${#numbers.formatDecimal(ligne.prixUnitaire, 0, 'POINT', 2, 'COMMA') + ' FCFA'}"></td>
                    <td class="text-right" th:text="${#numbers.formatDecimal(ligne.montantTotal, 0, 'POINT', 2, 'COMMA') + ' FCFA'}"></td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="daily-summary">
            <strong>Total pour la journée : </strong>
            <span th:text="${#numbers.formatDecimal(sousTotauxParJour.get(jour), 0, 'POINT', 2, 'COMMA') + ' FCFA'}"></span>
        </div>
    </div>


    <div class="report-summary">
        <h2 class="summary-title">Résumé de la Période</h2>
        <div class="summary-grid">
            <div>
                <span class="summary-label">Nombre Total de Ventes</span>
                <span class="summary-value" th:text="${nombreTotalVentes}"></span>
            </div>
            <div>
                <span class="summary-label">Panier Moyen</span>
                <span class="summary-value" th:text="${#numbers.formatDecimal(panierMoyen, 0, 'POINT', 2, 'COMMA') + ' FCFA'}"></span>
            </div>
            <div class="payment-summary">
                <h4 class="summary-label">Total par Moyen de Paiement</h4>
                <ul>
                    <li th:each="entry : ${totalParMoyenPaiement}">
                        <span th:text="${entry.key}"></span>:
                        <strong th:text="${#numbers.formatDecimal(entry.value, 0, 'POINT', 2, 'COMMA') + ' FCFA'}"></strong>
                    </li>
                </ul>
            </div>
            <div class="grand-total">
                <span class="summary-label">Total Général</span>
                <span class="summary-value-total" th:text="${#numbers.formatDecimal(totalGeneral, 0, 'POINT', 2, 'COMMA') + ' FCFA'}"></span>
            </div>
        </div>
    </div>
</div>

<button onclick="window.print()" class="print-button">Imprimer le Rapport</button>

</body>
</html>
